<div class="card">
  <div class="card-header">
    <h2 class="card-title">Cadastrar Ordem de Produ√ß√£o</h2>
  </div>

  <div class="progress-container">
    <div class="progress-steps">
      <div class="step active" data-step="1">
        <div class="step-circle">1</div>
        <div class="step-label">Selecionar Linha</div>
      </div>
      <div class="step" data-step="2">
        <div class="step-circle">2</div>
        <div class="step-label">Escolher Produto</div>
      </div>
      <div class="step" data-step="3">
        <div class="step-circle">3</div>
        <div class="step-label">Criar Ordem</div>
      </div>
      <div class="step" data-step="4">
        <div class="step-circle">4</div>
        <div class="step-label">Adicionar Itens</div>
      </div>
    </div>
  </div>

  <div class="card-content">
    <!-- Etapa 1: Sele√ß√£o de Linha -->
    <div class="form-section active" data-section="1">
      <div class="form-group">
        <label class="form-label">Selecione a Linha de Produ√ß√£o</label>
        <div class="info-panel">
          <div class="title">üè≠ Linhas Dispon√≠veis</div>
          <div class="content">
            Escolha a linha de produ√ß√£o onde ser√° executada a ordem de conting√™ncia.
          </div>
        </div>
        <div class="selection-grid" id="linhasGrid">
          <!-- Carregado dinamicamente via JavaScript -->
        </div>
      </div>
    </div>

    <!-- Etapa 2: Sele√ß√£o de Produto -->
    <div class="form-section" data-section="2">
      <div class="form-group">
        <label class="form-label">2Ô∏è‚É£ Selecione o Produto</label>
        <div class="info-panel">
          <div class="title">üì¶ Produtos da Linha</div>
          <div class="content">
            Produtos compat√≠veis com a linha selecionada (busca via relacionamento: produtos ‚Üí modelos ‚Üí itens ‚Üí equipamentos ‚Üí linhas).
          </div>
        </div>
        
        <!-- Filtro de busca por c√≥digo -->
        <div class="form-group">
          <label class="form-label">üîç Filtrar por C√≥digo</label>
          <input type="text" id="filtroCodigoProduto" class="form-control" placeholder="Digite o c√≥digo do produto para filtrar..." onkeyup="filterProducts()">
        </div>
        
        <div class="selection-grid compact-grid" id="produtosGrid">
          <!-- Carregado dinamicamente via JavaScript -->
        </div>
      </div>
    </div>

    <!-- Etapa 3: Cria√ß√£o da Ordem -->
    <div class="form-section" data-section="3">
      <div class="form-group">
        <label class="form-label">3Ô∏è‚É£ Configurar Ordem de Produ√ß√£o</label>
        <div class="info-panel">
          <div class="title">üìã Dados da Ordem</div>
          <div class="content">
            Configure os par√¢metros da ordem de produ√ß√£o de conting√™ncia.
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">N√∫mero da OP</label>
          <input type="number" id="numOrp" class="form-control" placeholder="Ex: 999001" min="1">
        </div>

        <div class="form-group">
          <label class="form-label">Quantidade a Produzir</label>
          <input type="number" id="qtdPrd" class="form-control" placeholder="Ex: 5000.0" step="0.1" min="0.1">
        </div>

        <div class="form-group">
          <label class="form-label">Quantidade Bateladas</label>
          <input type="number" id="qtdBat" class="form-control" placeholder="Ex: 100.0" step="0.1" min="0.1">
        </div>
      </div>
    </div>

    <!-- Etapa 4: Adi√ß√£o de Itens -->
    <div class="form-section" data-section="4">
      <div class="form-group">
        <label class="form-label">4Ô∏è‚É£ Adicionar Componentes √† Ordem</label>
        <div class="info-panel">
          <div class="title">‚öñÔ∏è Itens da Ordem</div>
          <div class="content">
            Adicione os componentes necess√°rios para a produ√ß√£o. Use as balan√ßas da linha selecionada.
          </div>
        </div>
        
        <div id="itensContainer">
          <!-- Equipamentos ser√£o renderizados dinamicamente baseados na linha selecionada -->
        </div>
      </div>
    </div>
  </div>

  <div class="form-actions">
    <button class="btn btn-secondary" onclick="previousStep()" id="btnPrevious" disabled>
      ‚Üê Anterior
    </button>
    <button class="btn btn-primary" onclick="nextStep()" id="btnNext" disabled>
      Pr√≥ximo ‚Üí
    </button>
  </div>
</div>

<!-- Modal para Sele√ß√£o de Mat√©ria-Prima -->
<div id="materiaPrimaModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Selecionar Mat√©ria-Prima</h3>
      <button type="button" class="modal-close" onclick="closeMateriaPrimaModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Fonte dos Produtos</label>
        <select id="materiaPrimaSource" class="form-control" onchange="loadMateriaPrima(1, document.getElementById('materiaPrimaFilter').value)">
          <option value="contingencia">Produtos de Conting√™ncia</option>
          <option value="erp">Produtos ERP (Mat√©ria-Prima)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Filtrar por C√≥digo</label>
        <input type="text" id="materiaPrimaFilter" class="form-control" placeholder="Digite o c√≥digo para filtrar..." onkeyup="filterMateriaPrima()">
      </div>
      
      <div class="materia-prima-list" id="materiaPrimaList">
        <!-- Carregado dinamicamente via JavaScript -->
      </div>
      
      <div class="pagination-container" id="materiaPrimaPagination">
        <!-- Pagina√ß√£o carregada dinamicamente -->
      </div>
    </div>
    
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="closeMateriaPrimaModal()">Cancelar</button>
    </div>
</div>

<!-- Modal de Confirma√ß√£o da Ordem - SIMPLIFICADO -->
<div class="modal" id="confirmOrderModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 8px; padding: 2rem; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid #eee; padding-bottom: 1rem;">
      <h3 style="margin: 0; color: #333;">üìã Confirmar Ordem</h3>
      <button type="button" onclick="closeConfirmOrderModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
    </div>
    
    <div style="margin-bottom: 1.5rem;">
      <h4 style="margin: 0 0 1rem 0; color: #555;">üìä Dados da Ordem</h4>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
        <div><strong>ORP:</strong> <span id="confirm-num-orp">-</span></div>
        <div><strong>Linha:</strong> <span id="confirm-linha">-</span></div>
        <div><strong>Produto:</strong> <span id="confirm-produto">-</span></div>
        <div><strong>Qtd. Produ√ß√£o:</strong> <span id="confirm-qtd-prd">-</span></div>
      </div>
    </div>

    <div style="margin-bottom: 1.5rem;">
      <h4 style="margin: 0 0 1rem 0; color: #555;">üîß Componentes</h4>
      <div id="confirm-components-list" style="max-height: 300px; overflow-y: auto;">
        <!-- Componentes ser√£o inseridos aqui -->
      </div>
    </div>

    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
      <button type="button" onclick="closeConfirmOrderModal()" style="padding: 0.75rem 1.5rem; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
        Cancelar
      </button>
      <button type="button" onclick="finalizeOrder()" style="padding: 0.75rem 1.5rem; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
        ‚úÖ Confirmar
      </button>
    </div>
  </div>
</div>

</div>

<!-- Alertas -->
<div id="alertContainer"></div>